{% extends "base.html" %}

{% block title %}Dataset Methodology | CardioPulse AI{% endblock %}

{% block content %}
<style>
    /* Premium Glass Section */
    .data-card-glow {
        background: var(--glass-bg);
        border-radius: 30px;
        padding: 40px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 20px 40px rgba(0,0,0,0.05);
        transition: all 0.4s ease;
    }

    .section-title {
        font-weight: 800;
        letter-spacing: -1px;
        margin-bottom: 2rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Interactive Steps */
    .process-timeline {
        position: relative;
        padding-left: 30px;
        border-left: 2px dashed #ff416c;
    }

    .step-item {
        position: relative;
        margin-bottom: 40px;
        transition: transform 0.3s ease;
    }

    .step-item:hover {
        transform: translateX(10px);
    }

    .step-number {
        position: absolute;
        left: -51px;
        background: var(--primary-gradient);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        box-shadow: 0 5px 15px rgba(255, 65, 108, 0.4);
    }

    /* Floating Feature Badges */
    .feature-chip {
        padding: 15px 25px;
        border-radius: 20px;
        background: white;
        border: 1px solid #eee;
        display: flex;
        align-items: center;
        gap: 15px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .feature-chip:hover {
        border-color: #ff416c;
        transform: scale(1.05);
        box-shadow: 0 10px 20px rgba(0,0,0,0.05);
    }

    /* Live Filter Search */
    #dictionarySearch {
        border-radius: 50px;
        padding: 12px 25px;
        border: 2px solid #eee;
        transition: all 0.3s;
        max-width: 400px;
        margin-bottom: 20px;
    }

    #dictionarySearch:focus {
        border-color: #ff416c;
        box-shadow: 0 0 0 0.25rem rgba(255, 65, 108, 0.1);
        outline: none;
    }

    .type-objective { background: #e3f2fd; color: #1976d2; }
    .type-examination { background: #f3e5f5; color: #7b1fa2; }
    .type-subjective { background: #fff3e0; color: #f57c00; }
</style>

<div class="animate__animated animate__fadeIn">
    <div class="row mb-5 text-center">
        <div class="col-lg-8 mx-auto">
            <span class="badge rounded-pill bg-light text-danger px-3 py-2 mb-3 fw-bold shadow-sm">
                <i class="fas fa-database me-2"></i>DATA ARCHITECTURE
            </span>
            <h1 class="display-4 fw-bold mb-4">The Science of the <span class="text-danger">Dataset</span></h1>
            <p class="lead text-muted">A deep dive into the 70,000 clinical records that power our Random Forest decision engine.</p>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="data-card-glow text-center">
                <h2 class="fw-bold text-danger mb-0">70K+</h2>
                <p class="text-muted small fw-bold mb-0">TOTAL RECORDS</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="data-card-glow text-center">
                <h2 class="fw-bold text-primary mb-0">11</h2>
                <p class="text-muted small fw-bold mb-0">BIOMARKERS</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="data-card-glow text-center">
                <h2 class="fw-bold text-success mb-0">73.9%</h2>
                <p class="text-muted small fw-bold mb-0">POST-CLEANING CONSISTENCY</p>
            </div>
        </div>
    </div>

    <h2 class="section-title">Anatomy of a Record</h2>
    <div class="row g-3 mb-5">
        <div class="col-md-3">
            <div class="feature-chip" onclick="filterTable('Objective')">
                <div class="icon bg-primary text-white rounded-circle px-2 py-1"><i class="fas fa-id-card"></i></div>
                <div class="fw-bold">Objective</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="feature-chip" onclick="filterTable('Examination')">
                <div class="icon bg-purple text-white rounded-circle px-2 py-1" style="background: purple;"><i class="fas fa-stethoscope"></i></div>
                <div class="fw-bold">Clinical</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="feature-chip" onclick="filterTable('Subjective')">
                <div class="icon bg-warning text-white rounded-circle px-2 py-1"><i class="fas fa-user-check"></i></div>
                <div class="fw-bold">Lifestyle</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="feature-chip" onclick="filterTable('')">
                <div class="icon bg-dark text-white rounded-circle px-2 py-1"><i class="fas fa-list"></i></div>
                <div class="fw-bold">Show All</div>
            </div>
        </div>
    </div>

    <div class="row align-items-center py-5">
        <div class="col-lg-6 mb-4 mb-lg-0">
            <h2 class="section-title">The Cleaning Pipeline</h2>
            <div class="process-timeline mt-4">
                <div class="step-item">
                    <div class="step-number">1</div>
                    <h5 class="fw-bold">Feature Clipping (IQR)</h5>
                    <p class="text-muted small">We capped physiological anomalies (e.g., BP > 240 or height < 120 cm) using IQR-based thresholds to prevent the model from learning extreme noise.</p>
                </div>
                <div class="step-item">
                    <div class="step-number">2</div>
                    <h5 class="fw-bold">Standardization</h5>
                    <p class="text-muted small">All continuous variables are scaled using Z-score normalization to ensure equal weighting during training.</p>
                </div>
                <div class="step-item">
                    <div class="step-number">3</div>
                    <h5 class="fw-bold">Class Balancing</h5>
                    <p class="text-muted small">The dataset was audited for target symmetry, resulting in a near 50/50 split of cardiac outcomes.</p>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="data-card-glow text-center p-5">
                <div class="animate__animated animate__pulse animate__infinite mb-4">
                    <i class="fas fa-shield-heart fa-5x text-danger opacity-75"></i>
                </div>
                <h4 class="fw-bold">Data Integrity Shield</h4>
                <p class="text-muted small">Our preprocessing logic ensures that every prediction is grounded in realistic medical ranges.</p>
            </div>
        </div>
    </div>

    

    <div class="d-flex justify-content-between align-items-end mb-3 mt-5">
        <h2 class="section-title mb-0">Feature Dictionary</h2>
        <input type="text" id="dictionarySearch" placeholder="Search features (e.g. 'Age')..." onkeyup="searchTable()">
    </div>

    <div class="card shadow-sm border-0 rounded-4 overflow-hidden mb-5">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4">Feature / Field Name</th>
                        <th>Category</th>
                        <th>Data Type</th>
                        <th>Logic / Description</th>
                        <th class="pe-4">Clinical Unit</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="ps-4">
                        <div class="fw-bold text-dark">Age</div>
                        <code class="small text-muted">age</code>
                        </td>
                        <td><span class="badge rounded-pill type-objective">Objective</span></td>
                        <td>Continuous</td>
                        <td>Calculated from days to years at prediction time.</td>
                        <td class="pe-4">Years</td>
                    </tr>
                    <tr>
                        <td class="ps-4">
                        <div class="fw-bold text-dark">Gender</div>
                        <code class="small text-muted">gender</code>
                        </td>
                        <td><span class="badge rounded-pill type-objective">Objective</span></td>
                        <td>Categorical</td>
                        <td>1: Women | 2: Men</td>
                        <td class="pe-4">N/A</td>
                    </tr>
                <tr>
                <td class="ps-4">
                <div class="fw-bold text-dark">Height</div>
                <code class="small text-muted">height</code>
                </td>
                <td><span class="badge rounded-pill type-objective">Objective</span></td>
                <td>Continuous</td>
                <td>Clipped between 120cm - 220cm.</td>
                <td class="pe-4">cm</td>
                </tr>
                <tr>
                <td class="ps-4">
                <div class="fw-bold text-dark">Weight</div>
                <code class="small text-muted">weight</code>
                </td>
                <td><span class="badge rounded-pill type-objective">Objective</span></td>
                <td>Continuous</td>
                <td>Clipped between 30kg - 200kg.</td>
                <td class="pe-4">kg</td>
                </tr>
                <tr>
                <td class="ps-4">
                <div class="fw-bold text-dark">Systolic BP</div>
                <code class="small text-muted">ap_hi</code>
                </td>
                <td><span class="badge rounded-pill type-examination">Examination</span></td>
                <td>Continuous</td>
                <td>Upper bound of blood pressure. Clipped at 240.</td>
                <td class="pe-4">mmHg</td>
                </tr>
                <tr>
                <td class="ps-4">
                <div class="fw-bold text-dark">Diastolic BP</div>
                <code class="small text-muted">ap_lo</code>
                </td>
                <td><span class="badge rounded-pill type-examination">Examination</span></td>
                <td>Continuous</td>
                <td>Lower bound of blood pressure. Clipped at 160.</td>
                <td class="pe-4">mmHg</td>
                </tr>
                <tr>
                <td class="ps-4">
                <div class="fw-bold text-dark">Cholesterol</div>
                <code class="small text-muted">cholesterol</code>
                </td>
                <td><span class="badge rounded-pill type-examination">Examination</span></td>
                <td>Ordinal</td>
                <td>1: Normal | 2: Above Normal | 3: Well Above Normal</td>
                <td class="pe-4">Scaling</td>
                </tr>
                <tr>
                <td class="ps-4">
                <div class="fw-bold text-dark">Glucose</div>
                <code class="small text-muted">gluc</code>
                </td>
                <td><span class="badge rounded-pill type-examination">Examination</span></td>
                <td>Ordinal</td>
                <td>1: Normal | 2: Above Normal | 3: Well Above Normal</td>
                <td class="pe-4">Scaling</td>
                </tr>
                <tr>
                <td class="ps-4">
                <div class="fw-bold text-dark">Smoke</div>
                <code class="small text-muted">smoke</code>
                </td>
                <td><span class="badge rounded-pill type-subjective">Subjective</span></td>
                <td>Binary</td>
                <td>Patient self-report: 0 (No) | 1 (Yes)</td>
                <td class="pe-4">Binary</td>
                </tr>
                <tr>
                <td class="ps-4">
                <div class="fw-bold text-dark">Alcohol</div>
                <code class="small text-muted">alco</code>
                </td>
                <td><span class="badge rounded-pill type-subjective">Subjective</span></td>
                <td>Binary</td>
                <td>Patient self-report: 0 (No) | 1 (Yes)</td>
                <td class="pe-4">Binary</td>
                </tr>
                <tr>
                <td class="ps-4">
                <div class="fw-bold text-dark">Physical Activity</div>
                <code class="small text-muted">active</code>
                </td>
                <td><span class="badge rounded-pill type-subjective">Subjective</span></td>
                <td>Binary</td>
                <td>Patient self-report: 0 (No) | 1 (Yes)</td>
                <td class="pe-4">Binary</td>
                </tr>
                </tbody>
                </table>
        </div>
    </div>

    <div class="text-center py-5">
        <a href="/visuals" class="btn btn-predict btn-lg shadow">
            Step Into Visualizations <i class="fas fa-chart-line ms-2"></i>
        </a>
    </div>
</div>

<script>
    // Search Functionality
    function searchTable() {
        let input = document.getElementById("dictionarySearch");
        let filter = input.value.toUpperCase();
        let table = document.getElementById("dataDictionary");
        let tr = table.getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {
            let td = tr[i].getElementsByTagName("td")[0];
            if (td) {
                let textValue = td.textContent || td.innerText;
                tr[i].style.display = textValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
            }
        }
    }

    // Category Filter Functionality
    function filterTable(category) {
        let table = document.getElementById("dataDictionary");
        let tr = table.getElementsByTagName("tr");
        for (let i = 1; i < tr.length; i++) {
            let td = tr[i].getElementsByTagName("td")[1];
            if (td) {
                let categoryText = td.textContent || td.innerText;
                tr[i].style.display = (category === "" || categoryText.includes(category)) ? "" : "none";
            }
        }
    }
</script>
{% endblock %}